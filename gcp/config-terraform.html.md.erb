---
title: Configuring BOSH Director on GCP using Terraform
owner: Ops Manager
iaas: GCP
install_type: terraform
---

Follow these instructions to configure the BOSH Director after you prepare to deploy <%= vars.ops_manager_first %> on Google Cloud Platform (GCP) using Terraform. For information about preparing to deploy <%= vars.ops_manager %> on GCP using Terraform, see [Preparing to deploy <%= vars.ops_manager %> on GCP using Terraform](prepare-env-terraform.html).

<%= partial "/pcf/warning-terraform" %>

<p> You can also perform the procedures in this topic using the <%= vars.ops_manager %> API. For more information, see <a href="../install/ops-man-api.html">Using the <%= vars.ops_manager %> API</a>.</p>


## <a id='prereq'></a> Prerequisite

To complete the procedures in this topic, you must have access to the output from when you ran `terraform apply` to create resources for this deployment. You can view this output at any time by running `terraform output`. You use the values in your Terraform output to configure the BOSH Director tile.


## <a id='access-om'></a> Step 1: Log into <%= vars.ops_manager %>

1. In a web browser, go to the fully qualified domain name (FQDN) of <%= vars.ops_manager %>.
Use the `ops_manager_dns` value from running `terraform output`.

    <p> In order to set up <%= vars.ops_manager %> authentication correctly, <%= vars.company_name %> recommends using a Fully Qualified Domain Name (FQDN) to access <%= vars.ops_manager %>. Using an ephemeral IP address to access <%= vars.ops_manager %> can cause authentication errors upon subsequent access.</p>

1. Log into <%= vars.ops_manager %>. To log in, see [Log In to <%= vars.ops_manager %> For the First Time](../login.html#login-first-time).

## <a id='gcp-config'></a> Step 2: Google Cloud Platform Config

1. Click the **Google Cloud Platform** tile within the <%= vars.ops_manager %> Installation Dashboard.

1. Click **Google Config**. Complete the following text boxes:
    * **Project ID**: Enter the value of `project` from your `terraform.tfvars` file.
    * **Default Deployment Tag**: Enter the value of `env_name` from your `terraform.tfvars` file.
    * Click **AuthJSON** and in the following text box enter the contents of the JSON file for you service account key.
        <p> As an alternative, you can click <strong>The <%= vars.ops_manager %> VM Service Account</strong> option to use the service account automatically created by GCP for the <%= vars.ops_manager %> VM.</p>

    ![alt-text=""](../common/images/gcp/google_config.png)

1. Click **Save**.

## <a id='director-config'></a> Step 3: Director Config page

<%= partial "../common/director-config" %>


## <a id='az'></a> Step 4: Create Availability Zones Page

  <div> <%= vars.company_name %> recommends at least three availability zones for a highly available installation.
    <ul>
      <li>For configuring a <%= vars.app_runtime_abbr %> deployment with multiple availability zones, see <a href="../refarch/gcp/gcp_ref_arch.html">Reference Architecture for <%= vars.ops_manager %> on GCP</a>.</li>
      <li>For <%= vars.k8s_runtime_abbr %> best practices for distributing workloads across multiple availability zones and clusters, see <a href="https://docs.vmware.com/en/VMware-Tanzu-Kubernetes-Grid-Integrated-Edition/1.16/tkgi/GUID-maintain-uptime.html">Maintaining Workload Uptime</a>.</li>
    </ul>
  </div>

1. Click **Create Availability Zones**.

1. Use the **Add** button to add three availability zones corresponding to those listed in the `azs` text box in your Terraform output.

1. Click **Save**.


## <a id='network'></a> Step 5: Create Networks page

1. Click **Create Networks**.

1. Make sure **Enable ICMP checks** is deselected. GCP routers do not respond to ICMP pings.

1. Use the **Add Network** button to create the following three networks:
    <p> To use a shared VPC network, enter the shared VPC host project name before the network name in the format <code>VPC-PROJECT-NAME/NETWORK-NAME/SUBNET-NAME/REGION-NAME</code>. For example, <code>vpc-project/opsmgr/central/us-central1</code>. For more information, see <a href="../install/gcp-shared-vpc.html">Configuring a Shared VPC on GCP</a>.</p>
    <h3>Infrastructure Network</h3>
    <table>
      <tr>
        <th>Network Name</th>
        <td><code>infrastructure</code></td>
      </tr>
      <tr>
        <th>Google Network Name</th>
        <td>Use the <code>network_name</code>, <code>infrastructure_subnet_name</code>, and <code>region</code> text boxes from your Terraform output to enter the name of the infrastructure network created by Terraform. <br>The format is: <code>network_name/infrastructure_subnet_name/region</code></td>
      </tr>
      <tr>
        <th>CIDR</th>
        <td>Enter the value of <code>infrastructure_subnet_cidrs</code> from your Terraform output.</td>
      </tr>
      <tr>
        <th>Reserved IP Ranges</th>
        <td>Enter the first <code>.1</code> through <code>.9</code> addresses from the CIDR. For example, if the CIDR is <code>192.168.101.0/26</code>, enter the range <code>192.168.101.1-192.168.101.9</code>.</td>
      </tr>
      <tr>
        <th>DNS</th>
        <td><code>169.254.169.254</code></td>
      </tr>
      <tr>
        <th>Gateway</th>
        <td>Enter the value of <code>infrastructure_subnet_gateway</code> from your Terraform output.</td>
      </tr>
      <tr>
        <th>Availability Zones</th>
        <td>Select all three availability zones.</td>
      </tr>
    </table>
    <h3>Runtime Network</h3>
    <table>
      <tr>
        <th>Network Name</th>
        <td>Enter the name of the runtime that you intend to deploy in this environment. For example, <code>pas</code> or <code>pks</code>.</td>
      </tr>
      <tr>
        <th>Google Network Name</th>
        <td>Use the <code>network_name</code>, <code>pas_subnet_name</code>, and <code>region</code> textb boxes from your Terraform output to enter the name of the runtime network created by Terraform. <br>The format is: <code>network_name/pas_subnet_name/region</code></td>
      </tr>
      <tr>
        <th>CIDR</th>
        <td>Enter the value of <code>pas_subnet_cidrs</code> from your Terraform output.</td>
      </tr>
      <tr>
        <th>Reserved IP Ranges</th>
        <td>Enter the first <code>.1</code> through <code>.9</code> addresses from the CIDR. For example, if the CIDR is <code>192.168.16.0/22</code>, enter the range <code>192.168.16.1-192.168.16.9</code>.</td>
      </tr>
      <tr>
        <th>DNS</th>
        <td><code>169.254.169.254</code></td>
      </tr>
      <tr>
        <th>Gateway</th>
        <td>Enter the value of <code>pas_subnet_gateway</code> from your Terraform output.</td>
      </tr>
      <tr>
        <th>Availability Zones</th>
        <td>Select all three availability zones.</td>
      </tr>
    </table>
    <h3>Services Network</h3>
    <table>
      <tr>
        <th>Network Name</th>
        <td><code>services</code></td>
      </tr>
      <tr>
        <th>Google Network Name</th>
        <td>Use the <code>network_name</code>, <code>services_subnet_name</code>, and <code>region</code> text boxes from your Terraform output to enter the name of the services network created by Terraform. <br>The format is: <code>network_name/services_subnet_name/region</code></td>
      </tr>
      <tr>
        <th>CIDR</th>
        <td>Enter the value of <code>services_subnet_cidrs</code> from your Terraform output.</td>
      </tr>
      <tr>
        <th>Reserved IP Ranges</th>
        <td>Enter the first <code>.1</code> through <code>.9</code> addresses from the CIDR. For example, if the CIDR is <code>192.168.16.0/22</code>, enter the range <code>192.168.20.1-192.168.20.9</code>.</td>
      </tr>
      <tr>
        <th>DNS</th>
        <td><code>169.254.169.254</code> </td>
      </tr>
      <tr>
        <th>Gateway</th>
        <td>Enter the value of <code>services_subnet_gateway</code> from your Terraform output.</td>
      </tr>
      <tr>
        <th>Availability Zones</th>
        <td>Select all three availability zones.</td>
      </tr>
    </table>
    <%= vars.expand_network_azs %>

## <a id='assign-azs'></a> Step 6: Assign AZs and Networks Page

1. Click **Assign AZs and Networks**.

1. From the drop-down menu, click a **Singleton Availability Zone**. The BOSH Director installs in this Availability Zone.

1. Under **Network**, click the `infrastructure` network for your BOSH Director.

1. Click **Save**.


## <a id='security'></a> Step 7: Security page

<%= partial "../common/security-pane" %>

## <a id='syslog'></a> Step 8: Syslog page

<%= partial "/pcf/ops-manager/syslog_bosh", :locals => { :syslog_context => 'BOSH Director' } %>

## <a id='resource-config'></a> Step 9: Resource Config Page

1. Click **Resource Config**.

    ![alt-text="The Resource Config dialog contains the following text boxes: Job, Instances, VM Type, and Persistent Disk Type."](../common/images/gcp/om_resource_config.png)

1. To add a load balancer to the BOSH Director, click the icon next to the **BOSH Director** job name to see the **Load Balancers** tExt box and **Internet Connected** check box. Ensure that the **Internet Connected** check box is not selected for any job. The Terraform templates do not provision a Network Address Translation (NAT) box for internet connectivity to your VMs, so instead VMs are provided with ephemeral public IP addresses to allow the jobs to reach the internet.

  <p> If you want to provision a Network Address Translation (NAT) box to provide internet connectivity to your VMs instead of providing them with public IP addresses, deselect the <strong>Internet Connected</strong> check boxes. For more information about using NAT in GCP, see the <a href="https://cloud.google.com/compute/docs/networking">GCP documentation</a>.</p>

  <p> If you install <%= vars.windows_runtime_first %>, provision your <strong>Main Compilation Job</strong> with at least 100&nbsp;GB of disk space.</p>

## <a id='custom-vm-extensions'></a> Step 10: (Optional) Add custom VM extensions

<%= partial '../common/vm-extension-config' %>

## <a id='complete'></a> Step 11: Complete the BOSH Director Installation

1. Click the <%= vars.ops_manager %> Installation Dashboard link to return to the Installation Dashboard.

1. Click **Review Pending Changes**, then **Apply Changes**. If the following ICMP error message appears, return to the [Network Config](#network) screen, and make sure you deselect the **Enable ICMP Checks** text box.
Click **Review Pending Changes**, then click **Apply Changes** again.

   ![alt-text="The Ops Manager errors list. There are two buttons: Ignore errors and start the install and Stop and fix errors."](../common/images/cloudform/install-error.png)

1. BOSH Director installs. This may take a few moments. When the installation process is complete, the **Changes Applied** window appears.

  ![alt-text="The Changes Applied dialog box has two buttons: Close and Return to Installation Dashboard."](../common/images/cloudform/ops-manager-complete.png)


## <a id='next'></a> Next Steps

After you followed this procedure, follow the instructions for the runtime you intend to install.
<ul>
  <li>To deploy <%= vars.app_runtime_abbr %>, see [Configuring <%= vars.app_runtime_abbr %>](https://docs.vmware.com/en/VMware-Tanzu-Application-Service/4.0/tas-for-vms/configure-pas.html).</li>
  <li>To prepare to deploy <%= vars.k8s_runtime_abbr %>, see [Creating Service Accounts in GCP for <%= vars.k8s_runtime_abbr %>](https://docs.vmware.com/en/VMware-Tanzu-Kubernetes-Grid-Integrated-Edition/1.16/tkgi/GUID-gcp-service-accounts.html).</li>
</ul>

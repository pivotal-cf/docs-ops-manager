---
title: Upgrading your Tanzu Operations Manager deployment
owner: Ops Manager
---

You can upgrade <%= vars.ops_manager_first %> and <%= vars.app_runtime_first %>
to <%= vars.v_major_version %>, and then upgrade your product tiles.

<p class="note important">
<span class="note__title"> Important</span> <strong>Breaking Changes:</strong> Read the <a href="../release-notes.html"><%= vars.ops_manager %> <%= vars.v_major_version %> Release Notes</a>,
<a href="https://docs.vmware.com/en/VMware-Tanzu-Application-Service/<%= vars.dot_major_tas_version %>/tas-for-vms/runtime-rn.html"><%= vars.app_runtime_full %> <%= vars.v_major_tas_version %> Release Notes</a>, <a href="https://docs.vmware.com/en/VMware-Tanzu-Application-Service/3.0/tas-for-vms/segment-rn.html"><%= vars.segment_runtime_full %> <%= vars.v_major_tas_version %> Release Notes</a>,
and <a href="https://docs.vmware.com/en/VMware-Tanzu-Application-Service/<%= vars.dot_major_tas_version %>/tas-for-vms/release-notes.html"><%= vars.windows_runtime_full %> <%= vars.v_major_tas_version %> Release Notes</a>, including the <em>Breaking Changes</em> and <em>Known Issues</em> sections,
before you start the upgrade process.
</p>

During an upgrade, the apps in your deployment continue to run. However, you cannot write to your deployment or make changes to apps during the upgrade. For details about how upgrading impacts individual <%= vars.app_runtime_abbr %> components,
see [What Happens During <%= vars.app_runtime_abbr %> Upgrades](https://docs.vmware.com/en/VMware-Tanzu-Application-Service/<%= vars.dot_major_tas_version %>/tas-for-vms/understanding-pas.html).

<%= vars.company_name %> recommends upgrading directly to <%= vars.ops_manager %> <%= vars.v_major_version %> from <%= vars.ops_manager %> v2.5 through v2.9.
To upgrade <%= vars.ops_manager %> to <%= vars.v_major_version %> from <%= vars.ops_manager %> v2.5 through v2.9, see [Jump Upgrade to <%= vars.ops_manager %> <%= vars.v_major_version %>](#jump-upgrade). To upgrade both <%= vars.ops_manager %> and <%= vars.app_runtime_abbr %>, see [Task 1: Prepare to Upgrade](#prepare).

## <a id='jump-upgrade'></a> Jump upgrade from <%= vars.ops_manager %> v2.5 through v2.9

Jump upgrading describes the process of skipping minor versions when upgrading <%= vars.ops_manager %>. Jump upgrading enables you to upgrade directly to the latest version of <%= vars.ops_manager %>, which is <%= vars.v_major_version %>. For more information, see [Jump Upgrading to <%= vars.ops_manager %> <%= vars.v_major_version %>](../jump-upgrades.html).

To jump upgrade to <%= vars.ops_manager %> <%= vars.v_major_version %>:

1. Review the prerequisites and breaking changes described in [Jump upgrading to <%= vars.ops_manager %> <%= vars.v_major_version %>](../jump-upgrades.html).

1. Complete the steps to prepare <%= vars.ops_manager %>, the BOSH Director, and BOSH-managed add-ons for upgrading in [Upgrade preparation checklist for <%= vars.ops_manager %> <%= vars.v_major_version %>](../upgrade/checklist.html). Do not complete the steps to prepare <%= vars.app_runtime_abbr %> for upgrading.

1. Follow the procedure in this topic to upgrade <%= vars.ops_manager %>, starting at [Task 1: Prepare to upgrade](#prepare). Do not complete the steps to upgrade <%= vars.app_runtime_abbr %>.

## <a id='upgrade-tas'></a> Upgrade <%= vars.app_runtime_abbr %>

Although you can skip minor versions when upgrading <%= vars.ops_manager %>, you should not skip minor versions when upgrading <%= vars.app_runtime_abbr %>. Skipping minor versions when upgrading <%= vars.app_runtime_abbr %> may result in additional breaking changes. To avoid this, upgrade <%= vars.app_runtime_abbr %> to the minor version that directly follows your current version of <%= vars.app_runtime_abbr %>.

If you are upgrading <%= vars.app_runtime_abbr %> to the next minor release:

1. Locate the version of [Upgrade preparation checklist for <%= vars.ops_manager %>](../upgrade/checklist.html) that is specific to the minor release version to which you are upgrading and complete the steps that are specific to <%= vars.app_runtime_abbr %>.

1. For more information, see the versions
of [Configuring <%= vars.app_runtime_abbr %> for upgrades](https://docs.vmware.com/en/VMware-Tanzu-Application-Service/<%= vars.dot_major_tas_version %>/tas-for-vms/configuring.html) in the <%= vars.app_runtime_abbr %> documentation and [Upgrading <%= vars.app_runtime_abbr %> and Other <%= vars.ops_manager %> Products](upgrading-products.html) that are specific to the minor release version to which you are upgrading.


## <a id='prepare'></a> Task 1: Prepare to upgrade

If you have not already, complete the steps in [Upgrade preparation checklist for <%= vars.ops_manager %> <%= vars.v_major_version %>](../upgrade/checklist.html).

## <a id='upgrade_ops'></a> Task 2: Upgrade <%= vars.ops_manager %> and installed products to <%= vars.v_major_version %>

The following sections describe how to upgrade <%= vars.ops_manager %> and installed products to <%= vars.ops_manager %> <%= vars.v_major_version %>:

* [Import installation to <%= vars.ops_manager %> <%= vars.v_major_version %> VM](#upgrade)
* [Import new <%= vars.app_runtime_abbr %> and product tiles](#upgrade-products)
* [Perform your upgrade](#perform-upgrade)
* [Restage apps](#restage-apps)

### <a id='upgrade'></a> Import installation to <%= vars.ops_manager %> <%= vars.v_major_version %> VM

To import your <%= vars.ops_manager %> installation to the <%= vars.ops_manager %> <%= vars.v_major_version %> VM:

1. Download the <%= vars.ops_manager %> VM Template <%= vars.v_major_version %> from
the [<%= vars.ops_manager %>](https://tanzu.vmware.com/products) download page on VMware Tanzu Network.

1. Record the fully qualified domain name (FQDN) address of the existing <%= vars.ops_manager %> VM.

1. To avoid conflicts, power off the existing <%= vars.ops_manager %> VM.

1. Deploy the new <%= vars.ops_manager %> VM by following the steps in one of these topics:
    * **AWS:** [Upgrading BOSH Director on AWS](aws-om-upgrade.html)
    * **Azure:** [Upgrading BOSH Director on Azure](azure-om-upgrade.html)
    * **GCP:** [Upgrading BOSH Director on GCP](gcp-om-upgrade.html)
    * **OpenStack:** [Deploying <%= vars.ops_manager %> on OpenStack](../openstack/setup.html)
    * **vSphere:** [Deploying <%= vars.ops_manager %> on vSphere](../vsphere/deploy.html)

1. When redirected to the **Welcome to <%= vars.ops_manager %>** page, click **Import Existing Installation**.

1. When you are prompted, enter the **Decryption Passphrase** for this <%= vars.ops_manager %> installation.
You set this passphrase during your initial installation of <%= vars.ops_manager %>.
    <p> If lost, the <strong>Decryption Passphrase</strong> cannot be recovered.</p>

1. Click **Choose File** and go to the installation ZIP file exported in the installation export step of your upgrade preparation. For more information, see [Export Your Installation](../upgrade/checklist.html#export) in _Upgrade Preparation Checklist for <%= vars.ops_manager %> <%= vars.v_major_version %>_.

1. Click **Import**.
    <p> Some browsers do not provide feedback on the status of the import process,
      and might appear to fail.</p>

2. A **Successfully imported installation** message appears upon completion.

    <p> <%= vars.ops_manager %> automatically imports the
      Telemetry for <%= vars.ops_manager %> tile.
      This tile collects product usage data, which helps improve VMware products and services. <br><br>
      Using Telemetry for <%= vars.ops_manager %> is optional
      and the tile does not share product usage data until you add and configure it.
      For more information, see the documentation for the
      <a href="https://docs.vmware.com/en/Tanzu-Telemetry-for-Ops-Manager/index.html">Telemetry for <%= vars.ops_manager %></a> tile.
    </p>

### <a id='upgrade-products'></a> Import new <%= vars.app_runtime_abbr %> and product tiles

<a name='success'></a> After you upgrade to <%= vars.ops_manager %> <%= vars.v_major_version %>, you must upgrade your product versions.

To upgrade your product versions:

1. Click **IMPORT A PRODUCT** to upload the product file.

1. In **IMPORT A BUTTON**, click **+** next to tile. This adds the tile to your staging area.

1. Click the newly-added tile to review and save any configurable options.

1. (Optional) If you use other service tiles, you can upgrade them following the same procedure.
For more information, see [Upgrading <%= vars.app_runtime_abbr %> and other <%= vars.ops_manager %> products](upgrading-products.html).

### <a id='perform-upgrade'></a> Complete your upgrade

<p> If the installation fails or returns errors, contact <%= vars.support_link %>. Do not attempt to roll back the upgrade by restarting the previous version's <%= vars.ops_manager %> VM.</p>

To complete your upgrade to <%= vars.ops_manager %> <%= vars.v_major_version %>:

1. Go to the <%= vars.ops_manager %> Installation Dashboard.

1. Click **Review Pending Changes**, then click **Apply Changes**. This immediately imports and applies upgrades to all tiles in a single transaction.

1. Click each service tile, click the **Status** tab, and confirm that all VMs appear and are in good health.

1. After confirming that the new installation functions correctly, remove the previous
version's <%= vars.ops_manager %> VM.


## <a id='monitor'></a> Task 3: Monitor the upgrade (optional)

The following sections describe how to monitor your <%= vars.ops_manager %> foundation during the upgrade and troubleshoot issues:

* [Check status and performance](#status)
* [Check Diego state](#diego)
* [Take snapshots of storage metrics](#storage)
* [Collect logs](#collect-logs)

### <a id='status'></a> Check status and performance

You can monitor the progress of the upgrade by checking the status of the foundation at various locations.

VMware recommends live-monitoring your upgrade with Healthwatch, which captures, calculates, stores, visualizes, and alerts on platform metrics, including:

* BOSH-reported VM metrics
* Runtime component metrics
* [Key Performance Indicators](https://docs.vmware.com/en/VMware-Tanzu-Application-Service/<%= vars.dot_major_tas_version %>/tas-for-vms/monitoring-kpi.html)
   and [Key Scaling Indicators](https://docs.vmware.com/en/VMware-Tanzu-Application-Service/<%= vars.dot_major_tas_version %>/tas-for-vms/monitoring-key-cap-scaling.html)
* Healthwatch-generated [super metrics](https://docs.vmware.com/en/Healthwatch-for-VMware-Tanzu/2.2/healthwatch/metrics.html)

For more information, see the [Healthwatch documentation](https://docs.vmware.com/en/Healthwatch-for-VMware-Tanzu/2.2/healthwatch/index.html).

If you are not using Healthwatch, you can do some or all of the following to monitor upgrade progress:

* Use the BOSH CLI to check the status of a task, VM, or instance. For more information, see [Check Status Using BOSH CLI](#bosh-cli-status) below.

* Check app availability.

* Run cf CLI commands.

* Check the availability of the <%= vars.ops_manager %> UI.

* If using a network-attached storage (NAS) server, check the server's performance.

* If on vSphere, check vSphere performance.

#### <a id='bosh-cli-status'></a> Check status using the BOSH CLI

To check the status of a task:

1. Run:

    ```
    bosh -e ALIAS task TASK-NUMBER
    ```

    Where:

    * `ALIAS` is your BOSH alias.
    * `TASK-NUMBER` is the number of the upgrade task you want to check.

To check the status of a VM:

1. Run:

    ```console
    bosh -e ALIAS vms --vitals
    ```
    Where `ALIAS` is your BOSH alias.

To check the status of an instance:

1. Run:

    ```
    bosh -e ALIAS instances --ps
    ```
    Where `ALIAS` is your BOSH alias.

### <a id='diego'></a> Check Diego state

You can use the CF Diego Operator Toolkit (cfdot) to check Diego component instance count by current state. For more information, see the [cfdot](https://github.com/cloudfoundry/cfdot) repository on GitHub.

### <a id='storage'></a> Take snapshots of storage metrics

You can periodically take snapshots of storage metrics. VMware recommends this if you have a large foundation and have experienced storage issues in the past.

###  <a id='collect-logs'></a> Collect logs

If you encounter problems during upgrade:

1. Collect the following information:
    * All job logs
    * Task debug logs for VM upgrade tasks
    * The installation log from <%= vars.ops_manager %>

This information helps determine the cause of upgrade issues.


## <a id='after'></a> Task 4: After upgrade

The following sections describe how to prepare for use of your new environment, check its health status,
and clean up after upgrading:

* [Recreate BOSH Alias](#bosh-alias)
* [Install new cf CLI](#cf-cli)
* [Check the health of your deployment](#health)
* [Check resource settings](#resource-settings)
* [Run BOSH clean-up](#bosh-cleanup)

### <a id='bosh-alias'></a> Recreate BOSH alias

To log in to BOSH after upgrading <%= vars.ops_manager %>, you must re-create your alias.

To re-create your alias using BOSH:

1. Run:

    ```
    bosh alias-env ALIAS -e DIRECTOR-IP
    ```
    Where:

    * `ALIAS` is the BOSH alias you are re-creating.
    * `DIRECTOR-IP` is the IP address of your BOSH Director VM.

### <a id='cf-cli'></a> Install new cf CLI

To install the version of the Cloud Foundry Command Line Interface (cf CLI) packaged with the <%= vars.app_runtime_abbr %> tile on VMware Tanzu Network:

1. Go to the [<%= vars.app_runtime_full %>](https://www.vmware.com/products.html) download page on VMware Tanzu Network.

1. Click the **CF CLI** download button.

1. Unzip the cf CLI ZIP file containing compressed binaries for the cf CLI.

1. Follow the procedure in the [<%= vars.app_runtime_abbr %>
documentation](https://docs.vmware.com/en/VMware-Tanzu-Application-Service/<%= vars.dot_major_tas_version %>/tas-for-vms/install-go-cli.html#bin).

### <a id='health'></a> Check the health of your deployment

Check the health of your deployment to ensure that all jobs and processes are running as expected.

To check the health of your deployment:

1. Check the health of each BOSH deployment in your installation by running:

    ```
    bosh -e ALIAS -d DEPLOYMENT-NAME instances --ps
    bosh -e ALIAS vms --vitals
    bosh -e ALIAS -d DEPLOYMENT-NAME cck --report
    ```

    Where:

    * `ALIAS` is your BOSH alias.
    * `DEPLOYMENT-NAME` is the name of your BOSH deployment.

1. Push and horizontally scale a test app to test <%= vars.app_runtime_abbr %> performance.

1. If you are running <%= vars.app_runtime_abbr %> MySQL as a cluster, run the `mysql-diag` tool to validate health of the cluster. For more information, see the BOSH CLI v2
instructions in [Running mysql-diag](https://docs.vmware.com/en/VMware-Tanzu-Application-Service/<%= vars.dot_major_tas_version %>/tas-for-vms/mysql-diag.html) in the <%= vars.app_runtime_abbr %> documentation.

### <a id='resource-settings'></a> Check resource settings

If you added custom **VM Type** or **Persistent Disk Type** options, you must ensure that these values are correctly set and were not overwritten.

To check your custom resource settings:

1. Go to the Installation Dashboard and click the **BOSH Director** tile.

1. Click **Resource Config**.

1. Ensure that the values for **VM Type** and **Persistent Disk Type** are correct.

### <a id='bosh-cleanup'></a> Run BOSH clean-up

To clean up old stemcells, releases, orphaned disks, and other unused resources:

1. Run:

    ```
    bosh -e ALIAS clean-up --all
    ```
    Where `ALIAS` is the BOSH alias you are recreating.

### <a id='restage-apps'></a> Restage apps

VMware recommends telling developers to restage any apps that use buildpacks that were updated as a part of this upgrade.

For more information about how developers can restage apps,
see
[Restage your app](https://docs.vmware.com/en/VMware-Tanzu-Application-Service/<%= vars.dot_major_tas_version %>/tas-for-vms/deploy-apps-start-restart-restage.html#restage) in _Starting, Restarting, and Restaging Apps_ in the <%= vars.app_runtime_abbr %> documentation.
